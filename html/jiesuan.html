<head>
	

	<link rel="stylesheet" type="text/css" href="http://misc.360buyimg.com/jdf/1.0.0/unit/??ui-base/1.0.0/ui-base.css,shortcut/2.0.0/shortcut.css,global-header/1.0.0/global-header.css,myjd/2.0.0/myjd.css,nav/2.0.0/nav.css,shoppingcart/2.0.0/shoppingcart.css,global-footer/1.0.0/global-footer.css,service/1.0.0/service.css">
	<link rel="stylesheet" type="text/css" href="http://static.360buyimg.com/item/default/1.0.32/components/??/common/common.css,/main/main.css,/address/address.css,/prom/prom.css,/colorsize/colorsize.css,/buytype/buytype.css,/track/track.css,/suits/suits.css,/baitiao/baitiao.css,/o2o/o2o.css,/summary/summary.css,/buybtn/buybtn.css,/crumb/crumb.css,/fittings/fittings.css,/detail/detail.css,/contact/contact.css,/popbox/popbox.css,/preview/preview.css,/info/info.css,/imcenter/imcenter.css,/jdservice/jdservice.css,/popupCar/popupCar.css">
	 <link href="../css/bootstrap.min.css?v=3.3.5" rel="stylesheet">
    <link href="../css/font-awesome.min.css?v=4.4.0" rel="stylesheet">
    <link href="../css/animate.min.css" rel="stylesheet">
    <link href="../css/style.min.css?v=4.0.0" rel="stylesheet">
	<style type="text/css">
		.main{
			width: 1200px;
			height: 100%;
			margin:0 auto;
		}
	</style>
</head>

<body>
	<!-- 主站头部 -->
	<div class="d-pad">
		<div id="shortcut-2014">
				<div class="w">
			    	<ul class="fl">
			    		<li class="dorpdown" id="ttbar-mycity">			<div class="dt cw-icon ui-areamini-text-wrap">				<i class="ci-right"><s>◇</s></i>				送至：<span class="ui-areamini-text" data-id="1" title="北京">北京</span> 			</div>			<div class="dd dorpdown-layer">				<div class="dd-spacer"></div>				<div class="ui-areamini-content-wrap"> 					<div class="ui-areamini-content"><div class="ui-areamini-content-list"><div class="item"><a data-id="1" href="javascript:void(0)" class="selected">北京</a></div><div class="item"><a data-id="2" href="javascript:void(0)">上海</a></div><div class="item"><a data-id="3" href="javascript:void(0)">天津</a></div><div class="item"><a data-id="4" href="javascript:void(0)">重庆</a></div><div class="item"><a data-id="5" href="javascript:void(0)">河北</a></div><div class="item"><a data-id="6" href="javascript:void(0)">山西</a></div><div class="item"><a data-id="7" href="javascript:void(0)">河南</a></div><div class="item"><a data-id="8" href="javascript:void(0)">辽宁</a></div><div class="item"><a data-id="9" href="javascript:void(0)">吉林</a></div><div class="item"><a data-id="10" href="javascript:void(0)">黑龙江</a></div><div class="item"><a data-id="11" href="javascript:void(0)">内蒙古</a></div><div class="item"><a data-id="12" href="javascript:void(0)">江苏</a></div><div class="item"><a data-id="13" href="javascript:void(0)">山东</a></div><div class="item"><a data-id="14" href="javascript:void(0)">安徽</a></div><div class="item"><a data-id="15" href="javascript:void(0)">浙江</a></div><div class="item"><a data-id="16" href="javascript:void(0)">福建</a></div><div class="item"><a data-id="17" href="javascript:void(0)">湖北</a></div><div class="item"><a data-id="18" href="javascript:void(0)">湖南</a></div><div class="item"><a data-id="19" href="javascript:void(0)">广东</a></div><div class="item"><a data-id="20" href="javascript:void(0)">广西</a></div><div class="item"><a data-id="21" href="javascript:void(0)">江西</a></div><div class="item"><a data-id="22" href="javascript:void(0)">四川</a></div><div class="item"><a data-id="23" href="javascript:void(0)">海南</a></div><div class="item"><a data-id="24" href="javascript:void(0)">贵州</a></div><div class="item"><a data-id="25" href="javascript:void(0)">云南</a></div><div class="item"><a data-id="26" href="javascript:void(0)">西藏</a></div><div class="item"><a data-id="27" href="javascript:void(0)">陕西</a></div><div class="item"><a data-id="28" href="javascript:void(0)">甘肃</a></div><div class="item"><a data-id="29" href="javascript:void(0)">青海</a></div><div class="item"><a data-id="30" href="javascript:void(0)">宁夏</a></div><div class="item"><a data-id="31" href="javascript:void(0)">新疆</a></div><div class="item"><a data-id="52993" href="javascript:void(0)">港澳</a></div><div class="item"><a data-id="32" href="javascript:void(0)">台湾</a></div><div class="item"><a data-id="84" href="javascript:void(0)">钓鱼岛</a></div><div class="item"><a data-id="53283" href="javascript:void(0)">海外</a></div></div></div> 				</div> 			</div>		</li>
			    	</ul>
			    	<ul class="fr">
						<li class="fore1 dorpdown" id="ttbar-login"><div class="dt cw-icon">						<i class="icon-plus-nickname"></i>	                    <i class="ci-right"><s>◇</s></i>	                    <a class="nickname" target="_blank" href="//home.jd.com/">zhbking2011</a>		            </div>		            <div class="dd dorpdown-layer">				<div class="dd-spacer"></div>				<div class="userinfo">					<div class="u-pic"><a target="_blank" href="//home.jd.com/"><img src="//storage.jd.com/i.imageUpload/7a68626b696e673230313131343530313437363730363735_mid.jpg" width="60" height="60"></a></div><div class="u-plus"><a href="https://passport.jd.com/uc/login?ltype=logout" class="link-logout">退出</a><a href="https://plus.jd.com/index" target="_blank" class="icon-plus-dropdown"></a></div>					<div class="u-msg"><a href="https://plus.jd.com/index" target="_blank">试用PLUS会员领免运费券&gt;</a></div>				</div>			<div class="badge-list">								<a href="javascript:void(0);" class="badge-list-prev">&lt;</a>								<div class="u-badges" style="position: relative;">									<div class="badge-panel-main" style="width: 740px; left: 0px; position: absolute;">										<div class="badge-panel fore1 ui-switchable-panel-selected u-dis" style="float: left; display: block;"><a href="https://plus.jd.com/index" target="_blank"><i></i><p class="u-name">免费试用</p></a></div><div class="badge-panel fore2" style="float: left; display: block;"><a href="//vip.jd.com/help.html#mypri-01" target="_blank"><i></i><p class="u-name">自营运费补贴</p></a></div>				<div class="badge-panel fore3" style="float: left; display: block;"><a href="//vip.jd.com/help.html#mypri-02" target="_blank"><i></i><p class="u-name">售后服务</p></a></div>				<div class="badge-panel fore4" style="float: left; display: block;"><a href="//vip.jd.com/help.html#mypri-03" target="_blank"><i></i><p class="u-name">评价奖励</p></a></div>				<div class="badge-panel fore8" style="float: left; display: block;"><a href="//vip.jd.com/help.html#mypri-06" target="_blank"><i></i><p class="u-name">装机服务</p></a></div>				<div class="badge-panel fore5 u-dis" style="float: left; display: block;"><a href="//vip.jd.com/help.html#mypri-04" target="_blank"><i></i><p class="u-name">会员特价</p></a></div>				<div class="badge-panel fore6 u-dis" style="float: left; display: block;"><a href="//vip.jd.com/help.html#mypri-05" target="_blank"><i></i><p class="u-name">生日礼包</p></a></div>				<div class="badge-panel fore7 u-dis" style="float: left; display: block;"><a href="//vip.jd.com/help.html#mypri-07" target="_blank"><i></i><p class="u-name">专享礼包</p></a></div>				<div class="badge-panel fore9 u-dis" style="float: left; display: block;"><a href="//vip.jd.com/help.html#mypri-08" target="_blank"><i></i><p class="u-name">贵宾专线</p></a></div>				<div class="badge-panel fore10 u-dis" style="float: left; display: block;"><a href="//vip.jd.com/help.html#mypri-09" target="_blank"><i></i><p class="u-name">运费券</p></a></div></div>								</div>								<a href="javascript:void(0);" class="badge-list-next">&gt;</a>							</div></div></li>
						<li class="spacer"></li>
						<li class="fore2">
							<div class="dt">
								<a target="_blank" href="//order.jd.com/center/list.action?cpdad=1DLSUE">我的订单</a>
							</div>
						</li>
						<li class="spacer"></li>
						<li class="fore3 dorpdown" id="ttbar-myjd">
							<div class="dt cw-icon">
								<i class="ci-right"><s>◇</s></i>
								<a target="_blank" href="//home.jd.com/?cpdad=1DLSUE">我的京东</a>
							</div>
							<div class="dd dorpdown-layer"><div class="dd-spacer"></div><div class="dd-inner"><span class="loading"></span></div></div>
						</li>
						<li class="spacer"></li>
						<li class="fore4">
							<div class="dt">
								<a target="_blank" href="//vip.jd.com/?cpdad=1DLSUE">京东会员</a>
							</div>
						</li>
						<li class="spacer"></li>
						<li class="fore5">
							<div class="dt">
								<a target="_blank" href="//b.jd.com/?cpdad=1DLSUE">企业采购</a>
							</div>
						</li>
						<li class="spacer"></li>
						<li class="fore6 dorpdown" id="ttbar-apps" aid="2_955_6342">
							<div class="dt cw-icon">
								<i class="ci-left"></i>
								<i class="ci-right"><s>◇</s></i>
								<a target="_blank" href="//app.jd.com/?cpdad=1DLSUE">手机京东</a>
							</div>
									<div class="dd dorpdown-layer">				<div class="dd-spacer"></div>				<div class="dd-inner" id="ttbar-apps-main"><div class="dd-spacer"></div><div class="dd-inner"><span class="loading"></span></div>				</div>			</div>		</li>
						<li class="spacer"></li>
						<li class="fore7 dorpdown" id="ttbar-atte" aid="2_955_6494">
							<div class="dt cw-icon">
								<i class="ci-right"><s>◇</s></i>关注京东
							</div>	
									<div class="dd dorpdown-layer">				<div class="dd-spacer"></div>				<div class="dd-inner" id="ttbar-atte-main"><div class="dd-spacer"></div><div class="dd-inner"><span class="loading"></span></div>				</div>			</div>		</li>
						<li class="spacer"></li>
						<li class="fore8 dorpdown" id="ttbar-serv">
							<div class="dt cw-icon">
								<i class="ci-right"><s>◇</s></i>客户服务
							</div>
							<div class="dd dorpdown-layer"><div class="dd-spacer"></div><div class="dd-inner"><span class="loading"></span></div></div>
						</li>
						<li class="spacer"></li>
						<li class="fore9 dorpdown" id="ttbar-navs">
							<div class="dt cw-icon">
								<i class="ci-right"><s>◇</s></i>网站导航
							</div>
							<div class="dd dorpdown-layer"><div class="dd-spacer"></div><div class="dd-inner"><span class="loading"></span></div></div>
						</li>
			    	</ul>
					<span class="clr"></span>
			    </div>
			</div>
			<div id="o-header-2013"><div id="header-2013" style="display:none;"></div></div>
					<div class="w">
			    <div id="logo-2014">
			    	<a href="//www.jd.com/?cpdad=1DLSUE" class="logo">京东</a>
			    </div>
			    <div id="search-2014">
					<ul id="shelper" class="hide" style="display: none;"></ul>
					<div class="form">
						<input type="text" onkeydown="javascript:if(event.keyCode==13) search('key');" autocomplete="off" id="key" accesskey="s" class="text">
						<button onclick="search('key');return false;" class="button cw-icon"><i></i>搜索</button>
					</div>
			    </div>
			    <div id="settleup-2014" class="dorpdown">
					<div class="cw-icon">
						<i class="ci-left"></i>
						<i class="ci-right">&gt;</i><i class="ci-count" id="shopping-amount">0</i>
						<a target="_blank" href="//cart.jd.com/cart/cart.html?cpdad=1DLSUE">我的购物车</a>
					</div>
					<div class="dorpdown-layer"><div class="spacer"></div><div id="settleup-content"><span class="loading"></span></div></div>
				</div>
			    <div id="hotwords-2014"><a href="https://sale.jd.com/act/KYSReXlP0c.html" target="_blank" style="color:#C81623;">199减100</a><a href="//sale.jd.com/act/b3YDaGdlQc.html" target="_blank">Surface</a><a href="https://sale.jd.com/act/v1F5oKD6CrL.html" target="_blank">爆款9.9元</a><a href="//sale.jd.com/act/1mAeZcCqIoi.html" target="_blank">满199减100</a><a href="https://sale.jd.com/act/MIaC2U0LhHcdyXj.html" target="_blank">满千减百</a><a href="https://sale.jd.com/act/CihYDkmHjrNoSJ.html" target="_blank">夏日饮品</a></div>
			    <span class="clr"></span>
			</div>
			<div id="nav-2014">
			    <div class="w">
			        <div class="w-spacer"></div>
					<div id="categorys-2014" class="dorpdown" data-type="default" style="height: auto; left: 0px; position: absolute;">
						<div class="dt">
							<a target="_blank" href="//www.jd.com/allSort.aspx?cpdad=1DLSUE">全部商品分类<i class="ci-right"><s>◇</s></i></a>
						</div>
					<div class="dd" style="display:none;"></div></div>
					<div id="navitems-2014" style="padding-left: 210px;">
						<ul id="navitems-group1">
							<li clstag="h|keycount|2015|06a" id="nav-fashion" class="fore1">
								<a target="_blank" href="//channel.jd.com/fashion.html?cpdad=1DLSUE">服装城</a>
							</li>
							<li clstag="h|keycount|2015|06b" id="nav-beauty" class="fore2">
								<a target="_blank" href="//channel.jd.com/beautysale.html?cpdad=1DLSUE">美妆馆</a>
							</li>
							<li clstag="h|keycount|2015|06c" id="nav-chaoshi" class="fore3">
								<a target="_blank" href="//channel.jd.com/chaoshi.html?cpdad=1DLSUE">超市</a>
							</li>
							<li clstag="h|keycount|2015|06i" id="nav-fresh" class="fore4">
								<a target="_blank" href="//fresh.jd.com?cpdad=1DLSUE">生鲜</a>
							</li>
						</ul>
						<div class="spacer"></div>
						<ul id="navitems-group2">
							<li clstag="h|keycount|2015|06d" id="nav-jdww" class="fore1">
								<a target="_blank" href="//www.jd.hk/?cpdad=1DLSUE">全球购</a>
							</li>
							<li clstag="h|keycount|2015|06e" id="nav-red" class="fore2">
								<a target="_blank" href="//red.jd.com/?cpdad=1DLSUE">闪购</a>
							</li>
							<li clstag="h|keycount|2015|06g" id="nav-auction" class="fore4">
								<a target="_blank" href="//paimai.jd.com/?cpdad=1DLSUE">拍卖</a>
							</li>
							<li clstag="h|keycount|2015|06h" id="nav-jr" class="fore5">
								<a target="_blank" href="//jr.jd.com/?cpdad=1DLSUE">金融</a>
							</li>
						</ul>
				    </div>
			        <div id="treasure"></div>
			        <span class="clr"></span>
			    </div>
			</div>
	</div>	
	<!-- 主站头部结束 -->

	<div class="container" style="margin:0 auto;width: 1220px;">
		
	</div>
	<div class="col-sm-12 foot" style="font-size: 18px;font-weight: bold;">
		<div class="col-sm-4"></div>
		<div class="col-sm-4">
			<span>已选择</span>
			<span id="itemNum" style="color:red"></span>
			<span>个商品</span>
			<span>总价：</span>
			<span id=totalPrice style="color:red"></span>
			<span>元</span>
		</div>
		<div class="col-sm-4">
			<button  class="btn btn-primary" style="width:100px">去结算</button>
		</div>
	</div>
	

</body>
    <script type="text/template" id="promoTpl">
            <div class="col-sm-12 group">
                <div class="ibox-content">
                    <table class="table table-striped table-bordered table-hover dataTables-example">
                        <thead>
                            <tr>
                                <th>是否选中</th>
                                <th style="width: 50%">商品名称</th>
                                <th>商品图片</th>
                                <th>实时价</th>
                                <th>数量</th>
                                <th>小计</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{ for(var i = 0; data[i]; i++){ }}
                            <tr class="gradeX">
                                <td>
                                    <input type="checkbox" value="">
                                </td>
                                <td>{{data[i].productDesc}}</td>
                                <td><img src="{{data[i].imgPath}}" style="width:60px;"></td>
                                <td class="nowPrice">{{data[i].price}}</td>
                                <th>
									<input class="number" type="number" name="" value="1" min="0" style="width: 40px;">
                                </th>
                                <th class="xiaoji">{{data[i].price}}</th>
                                <td>
                                	<button class="btn btn-danger delete">删除</button>
                                </td>
                            </tr>
                            {{ } }}
                         </tbody>
                    </table>
                </div>
            </div>
    </script>
      <script type="text/template" id="noPromoTpl">
      		<h2>普通商品</h2>
            <div class="col-sm-12">
                <div class="ibox-content">
                    <table class="table table-striped table-bordered table-hover dataTables-example">
                        <thead>
                            <tr>
                                <th>是否选中</th>
                                <th style="width: 50%;">商品名称</th>
                                <th>商品图片</th>
                                <th>京东价</th>
                                <th>数量</th>
                                <th>小计</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{ for(var i = 0; data[i]; i++){ }}
                            <tr class="gradeX">
                                <td>
                                    <input type="checkbox" value="">
                                </td>
                                <td>{{data[i].productDesc}}</td>
                                <td><img src="{{data[i].imgPath}}" style="width:60px;"></td>
                                <td class="nowPrice">{{data[i].price}}</td>
                                <th>
									<input class="number" type="number" name="" value="1" min="0" style="width: 40px;">
                                </th>
                                <th class="xiaoji">{{data[i].price}}</th>
                                <td>
                                	<button class="btn btn-danger delete">删除</button>
                                </td>
                            </tr>
                            {{ } }}
                         </tbody>
                    </table>
                </div>
            </div>
    </script>
<script type="text/javascript" src="../js/INTERFACE.js"></script>
<script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
<script type="text/javascript" src="../plugins/Tool/Tool.js"></script>
<script type="text/javascript">
	$(function(){

		// 刷新表格
        $.ajax({
            url: window.INTERFACE + '/product/all',
            data:{
            },
            type:'get',
            dataType:'jsonp',
            success:function(data){
            	
                data = data.slice(0,10);
                var skuInfo = data;
                var skuids = [];
                for(var i=0;i<data.length;i++){
                	skuids.push(data[i].sku);
                }
                skuids = skuids.join(',');
                $.ajax({
		            url: window.INTERFACE + '/promo/all',
		            data:{
		            	sku:skuids
		            },
		            type:'get',
		            dataType:'jsonp',
		            success:function(data){
		            	var promoInfo = data;
		            	process(skuInfo,promoInfo);
		            }
	            });
		    }
        })


        function process(skuInfo,promoInfo){
        	var obj = {};
        	for(var i=0;i<skuInfo.length;i++){
        		var _obj = skuInfo[i],
        			_sku = _obj.sku;
        		obj[_sku] = skuInfo[i]
        	}
        	for(var i=0;i<promoInfo.length;i++){
        		var _obj = promoInfo[i],
        			_sku = _obj.sku;
        		
    			for(var j in _obj){
    				obj[_sku][j] = _obj[j];
    			}
        	}
        	render(obj);
        }


        function render(obj){
        	var arr = [];
        	for(var i in obj){
        		arr.push(obj[i]);
        	}
        	console.log(arr);

        	var promoIds = (function(){
        		var result = [];
        		for(var i=0;i<arr.length;i++){
        			if(result.indexOf(arr[i].promoId)===-1 && arr[i].promoId!==undefined){
        				result.push(arr[i].promoId)
        			}
        		}
        		return result;
        	})();
        	var sorted = {};
        	var noPromo = [];
        	for(var i=0;i<promoIds.length;i++){
        		sorted[promoIds[i]] = [];
        	}
        	for(var i=0;i<arr.length;i++){
        		if(arr[i].promoId){
        			sorted[arr[i].promoId].push(arr[i])
        		}else{
        			noPromo.push(arr[i])
        		}
        	}
        	
        	var resultHtml = ''

        	for(var i in sorted){
        		resultHtml += Tool.render(sorted[i],$('#promoTpl').html());
        	}

    		resultHtml += Tool.render(noPromo,$('#noPromoTpl').html());

        	$('.container').html(resultHtml);
        }

        $(document).delegate('.number','click',function(){
        	var nowPrice = $(this).closest('tr').find('.nowPrice').text();
        	$(this).closest('tr').find('.xiaoji').text(nowPrice*$(this).val())
        })

        $(document).delegate('.delete','click',function(){
        	var _this = $(this);
        	if(_this.closest('tbody').find('tr').length<=1){
        		_this.closest('.group').remove();
        	}else{
        		_this.closest('tr').remove();
        	}
        })

        setInterval(function(){
        	var totalPrice = (function(){
        		var result = 0;
        		$('.xiaoji').each(function(){
        			result += new Number($(this).text());
        		})
        		return result;
        	})()
        	$('#totalPrice').text(totalPrice);
        },500);

	})
</script>